# 课后总结

这两部分课程囊括了关于计算机硬件和软件许多方向的知识。我认为丰富还不是它最大的特点，**最重要的是它帮我建立起了一个非常棒的知识体系**。这个清晰、简洁又坚实的骨架结构，可以支撑我不断去深入学习有关计算机任何一个方向的具体内容。

如今的网络虽然让信息变得丰富又触手可及，但是却因为缺少像这门课程所做的知识结构梳理，所以总让人觉得越学越糊涂，记住的东西越多离真相越远。

所以我的课后总结侧重在回忆出这副”骨架“，而且在总结的过程中，我发现自己仍然在轻松的惬意地，向这个体系里不断添加着新的知识。

## 计算机的硬件构造

一台计算机，不论有多么先进，都是由是四大类硬件组成的。

1. 数据存储设备

   如，ROM、RAM
   
   - ROM（read-only memory，只读），用来加载程序指令
   - RAM（random-access memory，可乱序存取），用来存取程序执行中所产生的数据

   本课程里的ROM和RAM是同一种硬件，即硬件结构、原理一样。由一大串Registe，寄存器组成。

   <details>
   <summary>数据存储设备还有其他类型</summary>
    
   - DADS（direct-access data storage media，有序存储）
   
     如，CD，DVD，HDD，磁带。

     此类设备的存储地址有远近区别。而RAM的读取可以认为是等距的，读取任何位置所需要的时间和复杂度相同。
   </details>
   
2. 芯片

   由一个ALU、几个Register和一个Program Counter构成一个核心单元。
   本课程的芯片是单核CPU，而更先进的芯片可能包含了多个核心单元，或有更强的计算功能ALU。
  
   - ALU（arithmetic and logic unit），数学和逻辑运算单元，由若干种逻辑门搭建。

   - Register，寄存器，一般由8/16/32/64个bit构成。一个bit能存一位数，0或者1。

     这里的“8/16/32/64”描述的是CPU“线宽”，对应“8位、16位、32位、64位”机。
     
   - Program Counter，指令地址寄存器/程序计数器，由寄存器，步进器，和两个控制信号组成。
    
3. 输入设备
  
   向RAM指定地址推送数据
  
4. 输出设备

   从RAM指定地址取用数据

输入和输出设备使用RAM哪段地址，推送的是什么样的数据，这些数据应该被怎样解读，多久刷新一次数据……
这些有关电脑与其他设备之间的分工配合问题，都是靠硬件协议和驱动程序来规范的。

输入和输出设备也可能有芯片，有存储。是一台可以独立运行的设备，如另一台电脑。
  
## 内存（RAM）的结构

### RAM的基础元素，寄存器
 
   RAM的基础单元是Register，寄存器。和CPU里的寄存器结构一样，线宽一般也是一样的。同时也是每次进行数据读取的最小单位。
   
   一个寄存器由n个bit组成，一个bit由一个Mux加一个DFF（data flip-flop）组成，存储1位数据：0或1。
   
   <这里画bit的数字逻辑图>

### RAM的结构，实现任意位置等效读取
   
   由不超过2<sup>n</sup>个寄存器组成的RAM，可以仅用一个同样结构的寄存器来完成选址工作。
   找到并存取RAM中任何一个位置的数据，难度和用时都是一样的。
   
   <这里画16位register选址结构图>
   
## 芯片（CPU）的结构
### CPU的构成
本课程的芯片是一个CPU（central processing unit），中央处理器。
由1个ALU，2个Register和1个Program Counter构成。

 - ALU（arithmetic and logic unit），数学和逻辑运算单元 

   ALU的构成：
   - 16位全加器 Full Adder（两个半加器Half Adder构成）
   - 16位Mux、16位Not、16位And等

   ALU的结构和所实现的计算：
   - 输入2个16位数据，6个1位的控制信号

     x(16), y(16);<br>
     zero x, not x, zero y, not y, x+y/x&y, not out; <br>
     这6个控制信号对应的计算步骤是顺序发生的，<br>
     也就是说，先处理x，再处理y，然后对x和y进行计算，再对结果进行一次处理。
     
   - 输出1个16位数据，2个1位的控制信号

     out(16)<br>
     zero, negative<br>
     ALU的计算结果将会被输出到D寄存器，A寄存器，M（RAM[A]）里，
     可以输出到这三个中的任意一个或多个位置，也可以不输出。
     
   - 靠6个控制信号可以对输入数据进行的计算是

     直接得到：0, 1, -1, x, y, !x, !y, -x, -y, <br>
     计算：x+1, x-1, y+1, y-1, x+y, x-y, y-x, x&y, x|y

     <这里画ALU的数字逻辑电路图>
          
 - Register，寄存器
   
   - D Register

     存储数据。由C类指令指挥ALU计算并输出结果到这个寄存器里。
     
   - A Register

     接收指令，程序指令如果是A类指令，会直接读到这个寄存器里。<br>
     作为RAM选址器，当需要输出或读取M（即，RAM[A]）时。
     
- PC（Program Counter），指令地址寄存器/程序计数器。
  
  PC的主要构成：
   - 16位增量器/步进器 Incrementer
   - 1位的reset控制信号，1位的load控制信号

  PC可以被手动归零（由reset控制），没有指令时每读一行程序（一个时钟周期）会自+1，也可以由C类指令控制将A寄存器的数据输入到PC里。
     
### CPU的结构

ALU，Register，PC
 - D寄存器 作为ALU的一个输入（x），
 - A寄存器/RAM[A] 作为ALU的另一个输入（y），
 - A寄存器可以输出到PC，
 - ALU可以输出到D寄存器，A寄存器，M（RAM[A]）里，
   可以输出到这三个中的任意一个或多个位置，也可以不输出。
 - PC 作为ROM的选址器，会把ROM[PC]输入A寄存器（如果是A类指令），
 - 或用做整个CPU里不同位置的控制信号（如果是C类指令）
   - 第15位决定指令是A类还是C类；
   - 第6-11位决定ALU进行什么计算；
   - 第3-5位决定ALU结果输出到什么地方；
   - 第0-2位决定是否输出A到PC
   - 第12-14位没用，C类指令时一般写1；
   
<这里画CPU的数字逻辑电路图>
    
## 芯片做什么事情？
 - 只处理二进制数据

   CPU只能接收二进制数据，进行二进制下的数学运算和逻辑运算，输出的也是二进制数据。（原因：芯片和数据存储设备的硬件结构限制）
   一个16位线宽的CPU，一次最多能从CPU的外部，也就是数据存储设备（比如ROM、RAM）里，获得一个16位的二进制数据，
   经过一个时钟周期的计算后，可以得到一个16位的二进制的计算结果，
   然后在下一个周期，可以把这个结果输入回CPU里进行下一步的运算，或者输出到CPU的外部，写到RAM里。

 - 一次接收一个数据
   
   虽然运算单元ALU每次都可以接收两个输入，但这两个输入里只有一个是接收来自CPU外部的数据，另一个则是以前步骤的计算结果暂存到D然后输回给ALU的。
   从CPU外部获取数据有两种来源/方式，一是在ROM读出PC指定的地址里的数据，输入A然后再输入ALU；另一种是读出RAM里A表示的地址里的数据，然后直接输出给ALU。

 - 运算

   不论是取自程序指令，还是内存，或是前几步的计算结果，一旦把数据给到ALU之后，它就开始运算。
   ALU能做什么样的运算，就意味着CPU能做什么样的运算。
   本课程的ALU有一个16位全加器，它能让x和y进行**加减运算**，或者让x、y中任意一个和0、1之间做加减运算；
   另外ALU中的16位与、或、非门，可以支持x和y之间做**与，或，非**的逻辑运算，以及x、y之中任意一个和0、1之间做与、或、非的逻辑运算。

 - 程序执行和跳转

   输入什么数据，做什么样的运算，都是由程序指令来控制的。
   程序指令加载在ROM里，CPU会从第一条指令，也就是从ROM[0]的位置开始，一条接一条读取。
   遇到A类指令，就把这条指令本身放到A寄存器里，
   遇到C类指令，就把这条指令作为控制信号。控制信号会决定让两个输入数据做哪种运算，会控制计算结果输出到什么地方，还会决定下一步读哪条指令。
   读ROM哪个位置，也就是读第几条指令，其实是由PC决定的，
   我们把PC的硬件设计成一开始数据总是0，所以CPU总是会从ROM[0]开始读程序指令。
   然后每读一次（一个时钟周期后）PC自+1，所以一个时钟周期结束，没有特殊指令时总是会读下一条指令。
   如果读到某条C类指令要求PC里的数据写入A寄存器里的数据，那么下一次读程序指令的位置就会跳转到这个指定的地址。
   
## 我们如何指挥“芯片”？
知道了芯片能做的事情，接下来就是指挥芯片做我们需要的事情了。

我们编的程序就是在告诉芯片：
 - 接下来要从外部的什么位置输入一条数据，

   这次是用ROM里的数，还是从RAM[A]取数，还是用A里现有的数。
   
 - 让喂给ALU的两条数据做什么样的运算，

   如，D+A，D｜M
     
 - 把计算结果输出到哪儿

   如，D=（），AMD=（）
   
 - 接下来该执行第几条程序了

   如，@A / condition; jump

## 操作系统、软件和程序语言、编程之间的关系
